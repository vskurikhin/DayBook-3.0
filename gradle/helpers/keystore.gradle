task start07CreateKeystore(type: Exec) {
    workingDir = getProperty("src.main.resources")
    executable "keytool"
    args "-genkeypair", "-alias", "boguscert", "-storepass", "password", "-keypass", "password", "-keyalg", "RSA", "-storetype", "JKS", "-keystore", "test.keystore", "-dname", "CN=Developer, OU=Department, O=Company, L=City, ST=State, C=CA"
}

start07CreateKeystore.onlyIf {
    def taskPath = it.path.toString()
    def submodule = taskPath.split(":")[1]
    def file = new File(submodule + "/${getProperty("src.main.resources")}/test.keystore")
    !file?.exists()
}

task start08ImportCertToKeystore(type: Exec) {
    workingDir = getProperty("src.main.resources")
    executable "keytool"
    args "-importcert", "-noprompt", "-trustcacerts", "-alias", "localhost", "-storepass", "password", "-file", "cert.pem", "-keystore", "test.keystore"
}

start08ImportCertToKeystore.onlyIf {
    def taskPath = it.path.toString()
    def submodule = taskPath.split(":")[1]
    def certFile = new File(submodule + "/${getProperty("src.main.resources")}/cert.pem")
    def keystoreFile = new File(submodule + "/${getProperty("src.main.resources")}/test.keystore")
    certFile?.exists() && !keystoreFile?.exists()
}